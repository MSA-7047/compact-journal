{% extends 'base_content.html' %}
{% block content %}
{% load static %}

<!-- Static CSS Files -->
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<link href="{% static 'django_ckeditor_5/dist/styles.css' %}" type="text/css" media="all" rel="stylesheet">

<!-- ==================== Main Dashboard Section ==================== -->
<section class="container d-flex flex-column h-100">

  <div class="first-row row pb-4 px-4 gy-4">
    <div class="col-xl-12 d-flex flex-column justify-content-center">
      <div class="welcome-message p-2 border bg-light ">
        
        <div class="small-buttons position-relative">
          <a class="btn btn-left" href="{% url 'dashboard' %}">
            <i class="bi bi-arrow-left me-2"></i>
            <span>Back</span>
          </a>
          {% if is_owner %}
          <div class="right-buttons">
            <a class="btn" href="{% url 'send_group_request' group_id=group.group_id%}">Invite Member</a>
            <a class="btn" href="{% url 'edit_group' group_id=group.group_id %}">Edit Group</a>
            <a class="btn btn-delete" href="{% url 'delete_group' group_id=group.group_id %}">Delete Group</a>
          </div>
          {% endif %}
        </div>

        <div class="d-flex flex-column justify-content-center align-items-center text-center">
          <h1>Group Dashboard: {{group.name}}</h1>

          <!--Group bio (?)-->
        </div>        
      </div>
    </div>
  </div>

  <div class="second-row row px-4 gy-4 pb-4 flex-fill">
    <div class="col-xl-5 d-flex flex-column">
      <div class="todays-journal p-2 border bg-light flex-grow-1">
        <h1>Members:</h1>
        <div class="content list-group py-3">
            {% if members %}
            {% for member in members %}
            <div class="list-group-item rounded py-3 mb-2 d-flex justify-content-between align-items-center">
                {{ member.username }}
                <div class="small-buttons position-relative">
                    <div class="right-buttons">
                        {% if user.username != member.username %}
                            {% if is_owner %}
                                <a class="btn btn-delete" href="{% url 'remove_player_from_group' group_id=group.group_id player_id=member.id %}">Kick Member</a>
                            {% endif %}
                        {% else %}
                            <a class="btn btn-delete" href="{% url 'leave_group' group_id=group.group_id %}">Leave Group</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
            {% endif %}
            {% if not members %}
                <div class="list-group-item">There are no members.</div>
            {% endif %}
        </div>

      </div>
    </div>



    <div class="col-xl-7 d-flex flex-column">
      <div class="your-groups p-2 border bg-light flex-grow-1 d-flex flex-column">
        <div class="d-flex justify-content-center">
          <h1>All Journal Entries</h1>
        </div>

        {% if journal_entries %}
        <div class="d-flex justify-content-center">
          <a class="btn" href="{% url 'journal_entries' user_id=user.id journal_id=journal.id %}">View all entries </a>
        </div>
        <ul class="list-group mt-3 flex-grow-1">
          {% for entry in journal_entries %}
          <li class="list-group-item">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h2><a href="{% url 'view_entry' entry_id=entry.id %}">{{ entry.title }}</a></h2>
                <p>Summary: {{ entry.summary }}</p>
                <p><b>Entry Date: {{ entry.entry_date }}</b></p>
              </div>
            </div>
          </li>
          {%endfor%}
          {% else %}
          <div class="d-flex justify-content-center text-center">
            <p>You have no entries for this journal.</p>
              <a role="button" class="btn btn-info" href="{% url 'view_group_journals' group_id=group.group_id%}">View All Group Journals</a>
          </div>
          {% endif %}
      </div>
    </div>
  </div>


</section>


<section class="container">
    <div class="row">
        <div class="col-12 border bg-light">
            <h1>Group Dashboard: {{ group.name }}</h1>
            <div class="group-list">
                {% if journals %}
                    {% for journal in journals %}
                        <div class="list-group-item">
                            {{ journal.journal_title }}
                            {{ journal.journal_description }}
                            {{ journal.entry_date }}
                            {{ journal.last_edited_by }}
                            {{ journal.journal_mood }}
                            <a role="button" class="btn btn-info" href="{% url 'edit_group_journal' group_id=group.group_id journal_id=journal.id%}">Edit Journal</a>
                            {% if is_owner %}
                                <form method="post" action="{% url 'delete_group_journal' group_id=group.group_id journal_id=journal.id %}">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-danger">Delete Journal</button>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% endif %}
                {% if not journals %}
                    <div class="list-group-item">
                        Your group has no journals
                    </div>
                {% endif %}
            </div>
            <a role="button" class="btn btn-info" href="{% url 'create_group_journal' group_id=group.group_id%}">Create Journal</a>

            <div class="list-group">
                {% if members %}
                    {% for member in members %}
                        <div class="list-group-item">
                            {{ member.username }}
                            {% if is_owner %}
                                <a
                                        role="button"
                                        class="btn btn-info"
                                        href="{% url 'remove_player_from_group' group_id=group.group_id player_id=member.id %}"
                                >Kick Member
                                </a>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% endif %}
                {% if not members %}
                    <div class="list-group-item">There are no members</div>
                {% endif %}
            </div>
            
            
        </div>
    </div>
</section>
{% endblock %}